<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book a Meeting | VerSprite</title>
  <meta name="theme-color" content="#0b0c10" />
  <link rel="icon" type="image/svg+xml" href="./favicon.svg" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

  <!-- Calendly CSS kept; JS will be lazy-loaded (Phase 2) -->
  <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet" />

  <style>
    :root{
      --vs-cyan:#54C5ED; /* brand light blue */
      --vs-red:#E83917;  /* brand orange */
      --vs-darkblue:#193554; /* brand dark blue */
      --vs-mint:#0CF5A8;    /* brand mint */
      --ink:#0B0C10;
      --panel:#111827;
      --panel-2:#0F172A;
      --text:#E5E7EB;
      --m:#9CA3AF;
      --header-h:56vh; /* fallback before JS calculates exact pixel height */
      --client-vh:100dvh; /* updated via visualViewport when available */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Barlow,Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans";color:var(--text);background:#000;overflow-x:hidden;padding-top:env(safe-area-inset-top);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right)}
    .visually-hidden{position:absolute!important;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}

    /* HERO */
    .hero{position:relative;min-height:56vh;display:grid;place-items:center;text-align:center;overflow:hidden;transition:min-height .4s ease, padding .4s ease, filter .3s ease;background:radial-gradient(1200px 600px at 50% -10%,rgba(84,197,237,.15),transparent),linear-gradient(180deg,rgba(0,0,0,.3),rgba(0,0,0,.9))}
    .hero.collapsed{min-height:12vh;display:flex;align-items:center;justify-content:center;padding:1rem}
    .hero picture.hero-bg{position:absolute;inset:0;display:block}
    .hero picture.hero-bg img{width:100%;height:100%;object-fit:cover;object-position:center;filter:saturate(120%) contrast(110%);opacity:.35}
    @media (prefers-reduced-motion: reduce){.hero picture.hero-bg img{opacity:.25;filter:none}}
    .hero.collapsed h1{font-size:1.25rem;letter-spacing:0;text-shadow:none;margin:0}
    .hero.collapsed p,.hero.collapsed .cta{display:none}
    .hero-toggle{position:absolute;top:.75rem;right:.75rem;background:rgba(0,0,0,.6);color:var(--vs-cyan);border:1px solid rgba(84,197,237,.4);font-size:.75rem;padding:.4rem .6rem;border-radius:6px;cursor:pointer}
    .hero-toggle:hover{background:rgba(0,0,0,.85);color:#fff}
    /* Hero background moved to <picture> for responsive formats */
    .hero h1{position:relative;font-family:Poppins,Barlow,system-ui,sans-serif;font-weight:800;font-size:clamp(2rem,5vw,4rem);letter-spacing:-.02em;text-shadow:0 0 14px rgba(84,197,237,.7)}
    .hero p{position:relative;max-width:780px;margin:1rem auto 2rem;color:var(--m)}
    .cta{position:relative;display:inline-block;padding:.85rem 1.2rem;border-radius:12px;font-family:Poppins,Barlow,system-ui,sans-serif;font-weight:700;color:#fff;background:var(--vs-red);box-shadow:0 0 16px rgba(232,57,23,.55);text-decoration:none;letter-spacing:.5px;text-transform:uppercase}
    .cta:hover{background:#ff5a21;box-shadow:0 0 22px rgba(255,90,33,.7)}

    .wrap{max-width:1080px;margin:0 auto;padding:3rem 1rem}
    .card{background:rgba(17,24,39,.85);border:1px solid rgba(84,197,237,.35);border-radius:18px;padding:1.5rem;box-shadow:0 0 28px rgba(84,197,237,.25);backdrop-filter: blur(6px)}
    .card h2{margin:0 0 1rem;font-family:Poppins,Barlow,system-ui,sans-serif;font-weight:800;text-align:center;color:var(--vs-cyan);text-shadow:0 0 12px rgba(84,197,237,.7)}
    .select{width:100%;background:var(--panel-2);color:var(--text);border:1px solid rgba(84,197,237,.35);border-radius:12px;padding:.8rem;outline:none}
    .select:focus{box-shadow:0 0 0 3px rgba(84,197,237,.35)}
    .panel{background:rgba(15,23,42,.9);border:1px solid rgba(84,197,237,.3);border-radius:12px;padding:1rem;min-height:260px}
    .muted{color:var(--m);text-align:center}

    footer{border-top:1px solid rgba(84,197,237,.2);color:#9aa1af;text-align:center;padding:2rem 1rem;background:rgba(0,0,0,.75)}
    footer a{color:var(--vs-cyan);text-decoration:none}
    footer a:hover{color:var(--vs-red)}
    /* Make Calendly smaller and centered */
    #calendly{padding:0}
  /* Reduced ~20% width & height (JS may override height to fit viewport) */
  #calendly .calendly-inline-widget{width:100%;max-width:656px;margin:0 auto;border-radius:12px;overflow:hidden;box-shadow:inset 0 0 24px rgba(0,0,0,.8), 0 0 0 1px rgba(84,197,237,.25);background:#0b0c10;height:clamp(420px,calc(var(--client-vh, 100dvh) - var(--header-h) - 32px),720px);transition:height .3s ease}
      /* Reduced motion preferences */
      @media (prefers-reduced-motion: reduce){
        .hero,.calendly-inline-widget{transition:none !important}
      }
  @media (min-width:1280px){#calendly .calendly-inline-widget{max-width:608px}}
  @media (min-width:1600px){#calendly .calendly-inline-widget{max-width:576px}}
  body{min-height:100dvh}
  #book{scroll-margin-top:16px}

  /* Expanded toggle removed per request */

  /* Sticky selector for convenience on mobile */
  #industry.select{position:sticky;top:8px;z-index:3;background:var(--panel-2)}

  /* Skeleton loading overlay */
  #calendly{position:relative}
  #calendly.loading .cal-skeleton{position:absolute;inset:8px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,.06) 25%, rgba(255,255,255,.12) 37%, rgba(255,255,255,.06) 63%);background-size:400% 100%;animation:shimmer 1.2s ease-in-out infinite;box-shadow:inset 0 0 24px rgba(0,0,0,.7)}
  @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}

    /* Mobile responsiveness */
    .select{min-height:44px;font-size:1rem}
    @media (max-width:600px){
      .wrap{padding:2rem .75rem}
      .hero{min-height:46vh}
      .card{padding:1rem;border-radius:14px}
      .card h2{font-size:1.25rem}
      .hero p{margin:.75rem auto 1.25rem;padding:0 .25rem}
      .cta{padding:.8rem 1rem;border-radius:10px}
      .panel{min-height:200px;padding:.75rem}
      footer{padding:1.2rem 1rem}
    }
  </style>
</head>
<body>
  <header class="hero" id="top">
    <picture class="hero-bg" aria-hidden="true">
      <img src="./Lucid_Origin_a_futuristic_cyberpunk_cityscape_at_night_with_vi_0.jpg" alt="Cyberpunk city skyline" loading="lazy" decoding="async" onerror="this.style.opacity='0';this.closest('.hero').style.background='radial-gradient(1200px 600px at 50% -10%,rgba(0,255,255,.15),transparent),linear-gradient(180deg,rgba(0,0,0,.3),rgba(0,0,0,.9))';" />
    </picture>
    <button class="hero-toggle" id="heroToggle" type="button" aria-pressed="false" aria-label="Toggle intro section">Collapse</button>
    <div class="wrap" style="padding:4rem 1rem">
      <h1>Contact Us</h1>
      <p>Choose your industry and instantly connect with the right VerSprite sales specialist calendar</p>
      <a class="cta" href="#book" aria-label="Skip to booking form and calendar">Get Started</a>
    </div>
  </header>

  <main class="wrap" id="book">
    <section class="card">
      <h2>Book Your Consultation</h2>
      <label for="industry" class="visually-hidden">Industry</label>
      <select id="industry" class="select" aria-label="Choose your industry">
        <option value="">-- Choose Your Industry --</option>
      </select>
      
      <div id="calendly" class="panel" style="margin-top:1rem">
        <div class="cal-skeleton" aria-hidden="true"></div>
        <p class="visually-hidden" aria-live="polite" id="cal-status">Calendar idle</p>
        <p class="muted">Select your industry above to reveal the meeting calendar.</p>
      </div>
    </section>
  </main>

  <footer>
    <div>Â© <span id="year"></span> VerSprite</div>
    <div style="margin-top:.3rem"><a href="https://versprite.com" target="_blank" rel="noopener">Visit versprite.com</a></div>
  </footer>

  <script>
    var industryToSalesperson = {
      "Education": "Haylie Leitzsey",
      "Energy & Utilities": "Haylie Leitzsey",
      "Information Technology & Software": "Haylie Leitzsey",
      "Insurance": "Haylie Leitzsey",
      "Telecommunications": "Haylie Leitzsey",
      "Construction": "Haylie Leitzsey",
      "Food & Beverage": "Haylie Leitzsey",
      "Hardware & Electronics": "Haylie Leitzsey",
      "Marketing, Media & Entertainment": "Haylie Leitzsey",
      "FinTech": "Sarah Kernan",
      "Automotive": "Sarah Kernan",
      "Consumer Goods (FMCG), Retail & eCommerce": "Sarah Kernan",
      "Financial Services (Banking & Investment)": "Sarah Kernan",
      "Government & Public Sector": "Sarah Kernan",
      "Healthcare & Life Sciences": "Sarah Kernan",
      "Hospitality & Travel": "Sarah Kernan",
      "Legal Services": "Sarah Kernan",
      "Manufacturing & Industrial": "Sarah Kernan",
      "Non-Profit & NGOs": "Sarah Kernan",
      "Professional Services (Consulting, Audit, Accounting, HR)": "Sarah Kernan",
      "Real Estate": "Sarah Kernan",
      "Transportation & Logistics": "Sarah Kernan"
    };

    var salespersonCalendly = {
      "Haylie Leitzsey": "https://calendly.com/haylieleitzsey/versprite-chat",
      "Sarah Kernan": "https://calendly.com/sarah-versprite/30min"
    };

    var industryCalendlyOverrides = {};

    var sel = document.getElementById('industry');
    Object.keys(industryToSalesperson).sort(function(a,b){return a.localeCompare(b);}).forEach(function(ind){
      var opt = document.createElement('option');
      opt.value = ind; opt.textContent = ind; sel.appendChild(opt);
    });

    var calWrap = document.getElementById('calendly');
    var headerEl = document.querySelector('.hero');
    var heroToggleBtn = document.getElementById('heroToggle');

    function collapseHero(shouldCollapse){
      if(!headerEl) return;
      var isCollapsed = headerEl.classList.contains('collapsed');
      if(shouldCollapse && !isCollapsed){ headerEl.classList.add('collapsed'); heroToggleBtn && (heroToggleBtn.textContent = 'Expand'); heroToggleBtn && heroToggleBtn.setAttribute('aria-pressed','true'); }
      if(!shouldCollapse && isCollapsed){ headerEl.classList.remove('collapsed'); heroToggleBtn && (heroToggleBtn.textContent = 'Collapse'); heroToggleBtn && heroToggleBtn.setAttribute('aria-pressed','false'); }
    }

    heroToggleBtn && heroToggleBtn.addEventListener('click', function(){
      var wantCollapse = !headerEl.classList.contains('collapsed');
      collapseHero(wantCollapse);
      // After toggling, refit the calendar height if present
      requestAnimationFrame(fitCalendlyHeight);
    });

    // Removed expand/collapse calendar button; default responsive sizing remains.

    function updateHeaderHeightVar(){
      if(!headerEl) return;
      var h = headerEl.getBoundingClientRect().height;
      document.documentElement.style.setProperty('--header-h', h + 'px');
    }

    function getCalendlyUrlForIndustry(industry){
      if (!industry) return null;
      if (industryCalendlyOverrides[industry]) return industryCalendlyOverrides[industry];
      var sp = industryToSalesperson[industry];
      return salespersonCalendly[sp] || null;
    }

    var calendlyScriptLoading = false;
    var calendlyReadyCallbacks = [];
    function ensureCalendlyScript(cb){
      if(window.Calendly && typeof window.Calendly.initInlineWidget === 'function'){ cb && cb(); return; }
      calendlyReadyCallbacks.push(cb);
      if(calendlyScriptLoading) return;
      calendlyScriptLoading = true;
      var s = document.createElement('script');
      s.src = 'https://assets.calendly.com/assets/external/widget.js';
      s.async = true;
      s.onload = function(){
        calendlyScriptLoading = false;
        calendlyReadyCallbacks.forEach(function(fn){ try{ fn && fn(); }catch(e){} });
        calendlyReadyCallbacks = [];
      };
      document.head.appendChild(s);
    }

    function renderCalendly(url){
      calWrap.innerHTML = '';
      if(!url){
        calWrap.innerHTML = '<p class="muted">No link configured yet for this selection.</p>';
        return;
      }

      // Enforce Calendly dark mode via URL params
      try {
        var u = new URL(url);
        var p = u.searchParams;
        if (!p.has('background_color')) p.set('background_color', '0b0c10'); // near-black
        p.set('text_color', 'e5e7eb');   // light gray text
        p.set('primary_color', '54c5ed'); // VS light blue accent
        url = u.origin + u.pathname + '?' + p.toString();
      } catch(e) {}

      var div = document.createElement('div');
      div.className = 'calendly-inline-widget';
      div.setAttribute('data-url', url);
      div.style.minWidth = '320px';
      calWrap.appendChild(div);

      // Show skeleton overlay while Calendly initializes
      calWrap.classList.add('loading');
      var skTimeout = setTimeout(function(){ calWrap.classList.remove('loading'); }, 5000);

      // Collapse hero, scroll into view, and fit height to the viewport
      collapseHero(true);
      document.getElementById('book').scrollIntoView({behavior:'smooth', block:'start'});
      // Fit after layout settles
      requestAnimationFrame(function(){
        updateHeaderHeightVar();
        setTimeout(updateHeaderHeightVar, 300); // after Calendly injects iframe
      });

      ensureCalendlyScript(function(){
        if(window.Calendly && typeof window.Calendly.initInlineWidget === 'function'){
          try { window.Calendly.initInlineWidget({ url: url, parentElement: div }); }catch(e){}
        }
        // Remove skeleton shortly after init is called
        setTimeout(function(){ calWrap.classList.remove('loading'); clearTimeout(skTimeout); }, 1200);
      });
    }

    sel.addEventListener('change', function(e){
      var chosen = e.target.value;
      if (!industryToSalesperson.hasOwnProperty(chosen)) {
        calWrap.innerHTML = '<p class="muted">Unknown industry selected.</p>';
        return;
      }
      renderCalendly(getCalendlyUrlForIndustry(chosen));
    });

    var params = new URLSearchParams(location.search);
    var preRaw = params.get('industry') || '';
    var pre = preRaw.toLowerCase();
    var keys = Object.keys(industryToSalesperson);
    var match = null;
    for (var i=0;i<keys.length;i++){
      if (keys[i].toLowerCase() === pre){ match = keys[i]; break; }
    }
    if (match){
      sel.value = match;
      renderCalendly(getCalendlyUrlForIndustry(match));
    }

    document.getElementById('year').textContent = new Date().getFullYear();

    // Viewport trigger: load Calendly script when booking section nears viewport
    var observer = new IntersectionObserver(function(entries){
      entries.forEach(function(entry){
        if(entry.isIntersecting){
          ensureCalendlyScript();
          observer.disconnect();
        }
      });
    }, {root:null, rootMargin:'200px', threshold:0.01});
    observer.observe(document.getElementById('book'));

    window.addEventListener('load', function(){ updateHeaderHeightVar(); });

    // Keep the calendar fitting to viewport on resize
    window.addEventListener('resize', function(){ updateHeaderHeightVar(); });

    // visualViewport-driven client vh for better mobile keyboard handling
    function setClientVh(){
      try{
        var vv = window.visualViewport;
        var h = vv && vv.height ? vv.height : window.innerHeight;
        document.documentElement.style.setProperty('--client-vh', h + 'px');
      }catch(e){
        document.documentElement.style.setProperty('--client-vh', window.innerHeight + 'px');
      }
    }
    setClientVh();
    if(window.visualViewport){
      window.visualViewport.addEventListener('resize', function(){ setClientVh(); updateHeaderHeightVar(); }, {passive:true});
    }

    // Initial header height variable set
    window.addEventListener('load', updateHeaderHeightVar);

    // Override smooth scroll if user prefers reduced motion
    function smoothScroll(el){
      var prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      el.scrollIntoView({behavior: prefersReduced ? 'auto' : 'smooth', block:'start'});
    }
  </script>
</body>
</html>